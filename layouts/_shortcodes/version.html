{{- $fmt := .Get "format" | default "short" -}}
{{- $def := printf "%v" (.Page.Site.Params.default_version | default "") -}}
{{- $raw := .Page.Site.Data.versions -}}
{{- $list := cond (isset $raw "versions") $raw.versions $raw -}}
{{- $pick := where $list "key" $def -}}
{{- $ver  := cond (gt (len $pick) 0) (index $pick 0) (index $list 0) -}}

{{- $scr := newScratch -}}
{{- if and $ver (isset $ver "docs_version") -}}
  {{- $scr.Set "v" $ver.docs_version -}}
{{- else -}}
  {{- $key := printf "%v" $ver.key -}}
  {{- $parts := split $key "." -}}
  {{- $maj := int (index (append $parts "0") 0) -}}
  {{- $min := int (index (append $parts "0") 1) -}}
  {{- $pat := int (index (append $parts "0") 2) -}}
  {{- $scr.Set "v" (dict "major" $maj "minor" $min "patch" $pat) -}}
{{- end -}}

{{- $v := $scr.Get "v" -}}
{{- $M := ($v.major | default 0) -}}
{{- $m := ($v.minor | default 0) -}}
{{- $p := ($v.patch | default 0) -}}

{{- if eq $fmt "semver" -}}
{{ printf "%d.%d.%d" $M $m $p }}
{{- else if eq $fmt "major" -}}
{{ printf "%d" $M }}
{{- else if eq $fmt "minor" -}}
{{ printf "%d" $m }}
{{- else if eq $fmt "patch" -}}
{{ printf "%d" $p }}
{{- else -}}
{{ printf "%d.%d" $M $m }}
{{- end -}}
