{{/* layouts/partials/recipes/list.html
     Hextra 0.11.0 — tables with Hextra badge shortcodes per tag.
     Reads data/recipes.yaml with keys: use_cases, advanced.
*/}}

{{- $data := site.Data.recipes -}}

{{/* Resolve a Page context so we can RenderString (needed for shortcodes). */}}
{{- $page := . -}}
{{- if reflect.IsMap . -}}
  {{- with index . "Page" }}{{ $page = . }}{{ end -}}
{{- end -}}

{{/* Render one Hextra badge via RenderString (works in HTML & MD) */}}
{{- define "tagBadge" -}}
  {{- $tag := .Tag -}}
  {{- $page := .Page -}}
  {{- $isMap := reflect.IsMap $tag -}}
  {{- $name := cond $isMap (index $tag "name") $tag -}}
  {{- $color := cond $isMap (or (index $tag "color") "gray") "gray" -}}
  {{- $badge := printf "{{< badge content=%q color=%q >}}" $name $color -}}
  {{- $page.RenderString $badge -}}
{{- end -}}

{{/* Render a section as a table */}}
{{- define "sectionTable" -}}
  {{- $title := .Title -}}
  {{- $items := .Items -}}
  {{- $page  := .Page  -}}

  {{/* Build a lowercased, trimmed lookup map once per section for contributor → svg */}}
  {{- $src := site.Data.icons.contributors | default dict -}}
  {{- $map := $src.map | default dict -}}
  {{- $lc  := dict -}}
  {{- range $k, $v := $map }}
    {{- $kk := lower (strings.TrimSpace (printf "%v" $k)) -}}
    {{- $lc = merge $lc (dict $kk $v) -}}
  {{- end -}}

  <div class="hx:space-y-3">
    <h2 class="hx:text-xl hx:font-semibold">{{ $title }}</h2>

    <div class="hx:overflow-x-auto hx:-mx-1 hx:md:mx-0">
      <table class="hx:min-w-full hx:divide-y hx:divide-gray-200 hx:dark:divide-gray-800 hx:text-sm">
        <thead class="hx:bg-gray-50 hx:dark:bg-gray-900/40">
          <tr>
            <th class="hx:px-4 hx:py-2 hx:text-left hx:font-semibold">Recipe</th>
            <th class="hx:px-4 hx:py-2 hx:text-left hx:font-semibold">Value</th>
            <th class="hx:px-4 hx:py-2 hx:text-left hx:font-semibold">Tags</th>
            <th class="hx:px-4 hx:py-2 hx:text-left hx:font-semibold">Contributor</th>
            <th class="hx:px-4 hx:py-2 hx:text-left hx:font-semibold">Status</th>
          </tr>
        </thead>
        <tbody class="hx:divide-y hx:divide-gray-100 hx:dark:divide-gray-800">
          {{- range $items }}
            {{/* Per-row contributor icon resolution */}}
            {{- $raw  := printf "%v" .contributor -}}
            {{- $key  := lower (strings.TrimSpace $raw) -}}
            {{- $file := index $lc $key -}}
            {{- $icon := cond $file (resources.Get (print "icons/" $file)) nil -}}

            <tr class="hover:hx:bg-gray-50 hover:hx:dark:bg-gray-900/30">
              <td class="hx:px-4 hx:py-2 hx:whitespace-nowrap">
                <a class="hx:underline hx:underline-offset-2" href="{{ .link }}">{{ .title }}</a>
              </td>
              <td class="hx:px-4 hx:py-2 hx:text-gray-700 hx:dark:text-gray-300">
                {{- .value -}}
              </td>
              <td class="hx:px-4 hx:py-2 hx:space-x-1 hx:whitespace-nowrap">
                {{- with .tags }}
                  {{- range . }}
                    {{- template "tagBadge" (dict "Tag" . "Page" $page) -}}
                  {{- end }}
                {{- end }}
              </td>
              <td class="hx:px-4 hx:py-2 hx:whitespace-nowrap hx:text-gray-600 hx:dark:text-gray-300" style="text-align: -webkit-center;">
                {{- with $icon -}}
                  {{ .Content | safeHTML }}
                {{- else -}}
                  {{- $raw -}}
                {{- end -}}
              </td>
              <td class="hx:px-4 hx:py-2 hx:space-x-1 hx:whitespace-nowrap">
                {{- with .status }}
                  {{- range . }}
                    {{- template "tagBadge" (dict "Tag" . "Page" $page) -}}
                  {{- end }}
                {{- end }}
              </td>
            </tr>
          {{- end }}
        </tbody>
      </table>
    </div>
  </div>
{{- end -}}

<div class="hx:space-y-8">
  {{- with $data.use_cases }}
    {{- template "sectionTable" (dict "Title" "Use cases" "Items" . "Page" $page) -}}
  {{- end }}
  {{- with $data.platform }}
    {{- template "sectionTable" (dict "Title" "Platform" "Items" . "Page" $page) -}}
  {{- end }}
</div>
